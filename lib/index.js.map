{"version":3,"file":"index.js","sources":["../src/babelPlugins/addTrack.js","../src/lib/util.js","../src/webpackPlugins/removeBabelLoaderCache.js","../src/index.js"],"sourcesContent":["module.exports = function (babel, options) {\n  console.log('********************：babel插件开始执行*******************')\n  const { types, template } = babel\n  return {\n    name: 'custom-babel-plugin',\n    visitor: {\n      Identifier (path, state) {\n        const { name } = path.node\n        if (name.endsWith('_track')) {\n          try {\n            if (path.node.loc && path.node.loc.start) {\n              const location = `---track: line ${path.node.loc.start.line}, column ${path.node.loc.start.column}, ${state.filename}---`;\n              console.log(location)\n              const parentNode = path.parent\n              const functionNode = parentNode.value\n              if (types.isFunctionExpression(functionNode)) {\n                const body = functionNode.body\n                if (types.isBlockStatement(body)) { // 有函数体就在开始插入埋点代码\n                  const params = functionNode.params\n                  var s = '{'\n                  params.forEach(p => {\n                    s = s + p.name + ':' + p.name + ','\n                  })\n                  s = s + 'baseTrackProps: this.baseTrackProps}'\n                  const tName = `'${name}'`\n                  const addCodeStr = `this.$track(${tName},${s})`\n                  body.body.unshift(template.statement(addCodeStr)());\n                }\n              }\n            }\n          } catch (error) {\n            console.error(error)\n          }\n        }\n      }\n    }\n  }\n}","const fs = require('fs')\n\n// 删除目录\nfunction removeDir (path) {\n  try {\n    if (fs.existsSync(path)) {\n      fs.accessSync(path)\n      var files = fs.readdirSync(path);\n      files.forEach(function (file, index) {\n        var curPath = path +\"/\" + file;\n        if (fs.statSync(curPath).isDirectory()) {// recurse\n          removeDir(curPath)\n        }else {// delete file\n          fs.unlinkSync(curPath,function (err) {\n            if (err)throw err\n          })\n        }\n      })\n      fs.rmdirSync(path)\n    }\n  } catch (error) {\n    console.log(error)\n  }\n}\n\n\nmodule.exports = {\n  removeDir: removeDir\n}\n\n","const util = require('../lib/util')\n\nconst pluginName = 'removeBabelLoaderCache'\nclass RemoveBabelLoaderCache {\n  constructor({basePath}){\n    // 传入的参数挂载在这个类的实例上.\n    this.basePath = basePath\n  }\n  apply(compiler) {\n\n    compiler.hooks.run.tap(pluginName, (compilation) => {\n      console.log('***** Webpack 构建过程开始！*****');\n      const babelLoaderCachePath = `${this.basePath}/node_modules/.cache/babel-loader`\n      util.removeDir(babelLoaderCachePath)\n    })\n\n    compiler.hooks.done.tap(pluginName, (stats) => {\n      console.log('***** Webpack 构建结束！*****')\n    })\n  }\n}\n\nmodule.exports = RemoveBabelLoaderCache;\n","\nconst addTrack = require('./babelPlugins/addTrack')\nconst RemoveBabelLoaderCache = require('./webpackPlugins/removeBabelLoaderCache')\n\nmodule.exports = {\n  addTrack: addTrack,\n  removeBabelLoaderCache: RemoveBabelLoaderCache\n}"],"names":["babel","options","console","log","types","template","name","visitor","Identifier","path","state","node","endsWith","loc","start","location","line","column","filename","parentNode","parent","functionNode","value","isFunctionExpression","body","isBlockStatement","params","s","forEach","p","tName","addCodeStr","unshift","statement","error","removeDir","fs","existsSync","accessSync","files","readdirSync","file","index","curPath","statSync","isDirectory","unlinkSync","err","rmdirSync","pluginName","RemoveBabelLoaderCache","basePath","compiler","hooks","run","tap","compilation","babelLoaderCachePath","util","done","stats","addTrack","removeBabelLoaderCache"],"mappings":";;;;;;;;AAAA,YAAc,GAAG,iBAAA,CAAUA,KAAV,EAAiBC,OAAjB,EAA0B;AACzCC,EAAAA,OAAO,CAACC,GAAR,CAAY,qDAAZ;AACA,MAAQC,KAAR,GAA4BJ,KAA5B,CAAQI,KAAR;AAAA,MAAeC,QAAf,GAA4BL,KAA5B,CAAeK,QAAf;AACA,SAAO;AACLC,IAAAA,IAAI,EAAE,qBADD;AAELC,IAAAA,OAAO,EAAE;AACPC,MAAAA,UADO,sBACKC,IADL,EACWC,KADX,EACkB;AACvB,YAAQJ,IAAR,GAAiBG,IAAI,CAACE,IAAtB,CAAQL,IAAR;;AACA,YAAIA,IAAI,CAACM,QAAL,CAAc,QAAd,CAAJ,EAA6B;AAC3B,cAAI;AACF,gBAAIH,IAAI,CAACE,IAAL,CAAUE,GAAV,IAAiBJ,IAAI,CAACE,IAAL,CAAUE,GAAV,CAAcC,KAAnC,EAA0C;AACxC,kBAAMC,QAAQ,4BAAqBN,IAAI,CAACE,IAAL,CAAUE,GAAV,CAAcC,KAAd,CAAoBE,IAAzC,sBAAyDP,IAAI,CAACE,IAAL,CAAUE,GAAV,CAAcC,KAAd,CAAoBG,MAA7E,eAAwFP,KAAK,CAACQ,QAA9F,QAAd;AACAhB,cAAAA,OAAO,CAACC,GAAR,CAAYY,QAAZ;AACA,kBAAMI,UAAU,GAAGV,IAAI,CAACW,MAAxB;AACA,kBAAMC,YAAY,GAAGF,UAAU,CAACG,KAAhC;;AACA,kBAAIlB,KAAK,CAACmB,oBAAN,CAA2BF,YAA3B,CAAJ,EAA8C;AAC5C,oBAAMG,IAAI,GAAGH,YAAY,CAACG,IAA1B;;AACA,oBAAIpB,KAAK,CAACqB,gBAAN,CAAuBD,IAAvB,CAAJ,EAAkC;;AAChC,sBAAME,MAAM,GAAGL,YAAY,CAACK,MAA5B;AACA,sBAAIC,CAAC,GAAG,GAAR;AACAD,kBAAAA,MAAM,CAACE,OAAP,CAAe,UAAAC,CAAC,EAAI;AAClBF,oBAAAA,CAAC,GAAGA,CAAC,GAAGE,CAAC,CAACvB,IAAN,GAAa,GAAb,GAAmBuB,CAAC,CAACvB,IAArB,GAA4B,GAAhC;AACD,mBAFD;AAGAqB,kBAAAA,CAAC,GAAGA,CAAC,GAAG,sCAAR;AACA,sBAAMG,KAAK,cAAOxB,IAAP,MAAX;AACA,sBAAMyB,UAAU,yBAAkBD,KAAlB,cAA2BH,CAA3B,MAAhB;AACAH,kBAAAA,IAAI,CAACA,IAAL,CAAUQ,OAAV,CAAkB3B,QAAQ,CAAC4B,SAAT,CAAmBF,UAAnB,GAAlB;AACD;AACF;AACF;AACF,WArBD,CAqBE,OAAOG,KAAP,EAAc;AACdhC,YAAAA,OAAO,CAACgC,KAAR,CAAcA,KAAd;AACD;AACF;AACF;AA7BM;AAFJ,GAAP;CAHF;;;;;;;;;;;;;;;;;;;;;;;;ACGA,SAASC,SAAT,CAAoB1B,IAApB,EAA0B;AACxB,MAAI;AACF,QAAI2B,sBAAE,CAACC,UAAH,CAAc5B,IAAd,CAAJ,EAAyB;AACvB2B,MAAAA,sBAAE,CAACE,UAAH,CAAc7B,IAAd;AACA,UAAI8B,KAAK,GAAGH,sBAAE,CAACI,WAAH,CAAe/B,IAAf,CAAZ;AACA8B,MAAAA,KAAK,CAACX,OAAN,CAAc,UAAUa,IAAV,EAAgBC,KAAhB,EAAuB;AACnC,YAAIC,OAAO,GAAGlC,IAAI,GAAE,GAAN,GAAYgC,IAA1B;;AACA,YAAIL,sBAAE,CAACQ,QAAH,CAAYD,OAAZ,EAAqBE,WAArB,EAAJ,EAAwC;;AACtCV,UAAAA,SAAS,CAACQ,OAAD,CAAT;AACD,SAFD,MAEM;;AACJP,UAAAA,sBAAE,CAACU,UAAH,CAAcH,OAAd,EAAsB,UAAUI,GAAV,EAAe;AACnC,gBAAIA,GAAJ,EAAQ,MAAMA,GAAN;AACT,WAFD;AAGD;AACF,OATD;AAUAX,MAAAA,sBAAE,CAACY,SAAH,CAAavC,IAAb;AACD;AACF,GAhBD,CAgBE,OAAOyB,KAAP,EAAc;AACdhC,IAAAA,OAAO,CAACC,GAAR,CAAY+B,KAAZ;AACD;AACF;;AAGD,QAAc,GAAG;AACfC,EAAAA,SAAS,EAAEA;AADI,CAAjB;;ACxBA,IAAMc,UAAU,GAAG,wBAAnB;;IACMC;AACJ,wCAAuB;AAAA,QAAVC,QAAU,QAAVA,QAAU;;AAAA;;;AAErB,SAAKA,QAAL,GAAgBA,QAAhB;AACD;;;;WACD,eAAMC,QAAN,EAAgB;AAAA;;AAEdA,MAAAA,QAAQ,CAACC,KAAT,CAAeC,GAAf,CAAmBC,GAAnB,CAAuBN,UAAvB,EAAmC,UAACO,WAAD,EAAiB;AAClDtD,QAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACA,YAAMsD,oBAAoB,aAAM,KAAI,CAACN,QAAX,sCAA1B;AACAO,QAAAA,IAAI,CAACvB,SAAL,CAAesB,oBAAf;AACD,OAJD;AAMAL,MAAAA,QAAQ,CAACC,KAAT,CAAeM,IAAf,CAAoBJ,GAApB,CAAwBN,UAAxB,EAAoC,UAACW,KAAD,EAAW;AAC7C1D,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACD,OAFD;AAGD;;;;;;AAGH,0BAAc,GAAG+C,sBAAjB;;OClBc,GAAG;AACfW,EAAAA,QAAQ,EAAEA,QADK;AAEfC,EAAAA,sBAAsB,EAAEZ;AAFT;;;;"}